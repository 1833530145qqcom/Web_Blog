import{u as h}from"./vuex.81148b15.js";import{d as v,a0 as D,c as A,X as e,R as l,f as E,af as r,o as F,a as B,V as _,n as H}from"./@vue.a8364f98.js";const z={__name:"MyInfo",setup(j){const{proxy:n}=E(),w=h(),m={getUserInfo:"getUserInfo",saveMyInfo:"saveMyInfo",saveAvatar:"saveAvatar",updateMyPassword:"updateMyPassword"},a=v({}),U=(s,o,f)=>{o!==d.value.password?f(new Error(s.message)):f()},V={nickName:[{required:!0,message:"\u6635\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],editorType:[{required:!0,message:"\u8BF7\u9009\u62E9\u9ED8\u8BA4\u7F16\u8F91\u5668"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801"},{validator:n.Verify.password,message:"\u5BC6\u7801\u6700\u5C118\u4F4D\uFF0C\u53EA\u80FD\u6570\u5B57\u5B57\u6BCD\u548C\u7279\u6B8A\u5B57\u7B26"}],rePassword:[{required:!0,message:"\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801"},{validator:U,message:"\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4"}],phone:[{required:!0,message:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"},{validator:n.Verify.phone,trigger:"blur",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7"}]};(async()=>{let s=await n.Request({url:m.getUserInfo});!s||(a.value=s.data)})();const g=v(null),N=async()=>{g.value.validate(async s=>{!s||!await n.Request({url:m.saveMyInfo,params:{avatar:a.value.avatar,nickName:a.value.nickName,phone:a.value.phone,editorType:a.value.editorType,profession:a.value.profession,introduction:a.value.introduction}})||(n.Message.success("\u4FDD\u5B58\u6210\u529F"),w.commit("updateUserInfo",{nickName:a.value.nickName,avatar:a.value.avatar}))})},I=async s=>{await n.Request({url:m.saveAvatar,params:{avatar:s}})||reutrn,n.Message.success("\u5934\u50CF\u4FEE\u6539\u6210\u529F"),w.commit("updateUserInfo",{nickName:a.value.nickName,avatar:s})},d=v({}),c=v(null),p=D({show:!1,title:"\u4FEE\u6539\u5BC6\u7801",buttons:[{type:"danger",text:"\u786E\u5B9A",click:s=>{x()}}]}),M=()=>{p.show=!0,H(()=>{c.value.resetFields(),d.value={}})},x=()=>{c.value.validate(async s=>{if(!s)return;await n.Request({url:m.updateMyPassword,params:{password:d.value.password}})||reutrn,p.show=!1,n.Message.success("\u5BC6\u7801\u4FEE\u6539\u6210\u529F")})};return(s,o)=>{const f=r("CoverUpload"),u=r("el-form-item"),i=r("el-input"),y=r("el-radio"),C=r("el-radio-group"),P=r("el-button"),b=r("el-col"),R=r("EditorHtml"),q=r("el-row"),k=r("el-form"),T=r("Dialog");return F(),A("div",null,[e(k,{model:a.value,rules:V,ref_key:"formDataRef",ref:g,"label-width":"100px"},{default:l(()=>[e(q,{gutter:10},{default:l(()=>[e(b,{span:8},{default:l(()=>[e(u,{label:"\u5934\u50CF",prop:"avatar"},{default:l(()=>[e(f,{modelValue:a.value.avatar,"onUpdate:modelValue":o[0]||(o[0]=t=>a.value.avatar=t),onCallback:I},null,8,["modelValue"])]),_:1}),e(u,{label:"\u6635\u79F0",prop:"nickName"},{default:l(()=>[e(i,{modelValue:a.value.nickName,"onUpdate:modelValue":o[1]||(o[1]=t=>a.value.nickName=t),placeholder:"\u8BF7\u8F93\u5165\u6635\u79F0"},null,8,["modelValue"])]),_:1}),e(u,{label:"\u624B\u673A\u53F7",prop:"phone"},{default:l(()=>[e(i,{modelValue:a.value.phone,"onUpdate:modelValue":o[2]||(o[2]=t=>a.value.phone=t),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"},null,8,["modelValue"])]),_:1}),e(u,{label:"\u5BC6\u7801"},{default:l(()=>[B("a",{href:"javascript:void(0)",class:"a-link",onClick:M},"\u4FEE\u6539\u5BC6\u7801")]),_:1}),e(u,{label:"\u9ED8\u8BA4\u7F16\u8F91\u5668",prop:"editorType"},{default:l(()=>[e(C,{modelValue:a.value.editorType,"onUpdate:modelValue":o[3]||(o[3]=t=>a.value.editorType=t)},{default:l(()=>[e(y,{label:0},{default:l(()=>[_("\u5BCC\u6587\u672C\u7F16\u8F91\u5668")]),_:1}),e(y,{label:1},{default:l(()=>[_("MarkDown\u7F16\u8F91\u5668")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"\u804C\u4E1A",prop:"profession"},{default:l(()=>[e(i,{modelValue:a.value.profession,"onUpdate:modelValue":o[4]||(o[4]=t=>a.value.profession=t),placeholder:"\u8BF7\u8F93\u5165\u804C\u4E1A"},null,8,["modelValue"])]),_:1}),e(u,{label:"",prop:"editorType"},{default:l(()=>[e(P,{type:"danger",onClick:N},{default:l(()=>[_("\u4FDD\u5B58")]),_:1})]),_:1})]),_:1}),e(b,{span:16},{default:l(()=>[e(u,{label:"\u7B80\u4ECB",prop:"introduction"},{default:l(()=>[e(R,{modelValue:a.value.introduction,"onUpdate:modelValue":o[5]||(o[5]=t=>a.value.introduction=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),e(T,{show:p.show,title:p.title,buttons:p.buttons,width:"400px",onClose:o[8]||(o[8]=t=>p.show=!1)},{default:l(()=>[e(k,{model:d.value,rules:V,ref_key:"passwordFormRef",ref:c,"label-width":"80px"},{default:l(()=>[e(u,{label:"\u5BC6\u7801",prop:"password"},{default:l(()=>[e(i,{placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",type:"password",modelValue:d.value.password,"onUpdate:modelValue":o[6]||(o[6]=t=>d.value.password=t)},null,8,["modelValue"])]),_:1}),e(u,{label:"\u91CD\u590D\u5BC6\u7801",prop:"rePassword"},{default:l(()=>[e(i,{placeholder:"\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801",type:"password",modelValue:d.value.rePassword,"onUpdate:modelValue":o[7]||(o[7]=t=>d.value.rePassword=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}};export{z as default};
