import{H as se}from"./highlight.js.8b3b617d.js";import{a0 as W,d as v,af as s,o as r,c as u,X as e,R as l,a as c,W as N,n as j,f as Q,G as ne,Q as te,V as re,F as ce}from"./@vue.a8364f98.js";const ie=c("div",{class:"card-header"},[c("span",null,"\u4E13\u9898\u6587\u7AE0")],-1),de={class:"custom-node-style"},ue={class:"node-title"},pe={key:0,style:{color:"red","font-size":"13px"}},_e={key:1,style:{color:"green","font-size":"13px"}},ge=c("div",{class:"card-header"},[c("span",null,"\u6587\u7AE0\u8BE6\u60C5")],-1),ve={key:0},fe={class:"my-title"},me=["innerHTML"],ye={key:1,class:"no-data"},he={__name:"BlogDetail",setup(X,{expose:f}){const{proxy:b}=Q(),y={getBlogDetail:"/blog/getBlogById",getSpecialInfo:"blog/getSpecialInfo"},C=W({show:!1,buttons:[{type:"danger",text:"\u786E\u5B9A",click:i=>{C.show=!1}}]}),S=v(null),h=v({}),T=async i=>{C.show=!0,S.value=i.blogId,$(i.categoryId),w(i.blogId)},w=async i=>{let m=await b.Request({url:y.getBlogDetail,params:{blogId:i}});!m||(h.value=m.data,j(()=>{document.querySelectorAll("pre code").forEach(B=>{se.highlightBlock(B)})}))},D=i=>{if(i.blogId=="0"){h.value={};return}w(i.blogId)},_={children:"children",label:"title",value:"blogId"},g=v([]),R=v(null),$=async i=>{let m=await b.Request({url:y.getSpecialInfo,params:{categoryId:i,showType:"1"}});!m||(g.value=m.data,j(()=>{R.value.setCurrentKey(S.value)}))};return f({showDetail:T}),(i,m)=>{const n=s("el-tree"),B=s("el-card"),V=s("el-col"),k=s("el-row"),E=s("Window");return r(),u("div",null,[e(E,{show:C.show,buttons:C.buttons,showCancel:!1,onClose:m[0]||(m[0]=d=>C.show=!1)},{default:l(()=>[e(k,{gutter:10},{default:l(()=>[e(V,{span:10},{default:l(()=>[e(B,{class:"box-card"},{header:l(()=>[ie]),default:l(()=>[e(n,{class:"tree-panel",ref_key:"refTree",ref:R,data:g.value,defaultExpandAll:"","node-key":"blogId","expand-on-click-node":!1,props:_,"highlight-current":!0,onNodeClick:D},{default:l(({node:d,data:a})=>[c("span",de,[c("span",ue,[a.status==0?(r(),u("span",pe,N(a.title),1)):(r(),u("span",_e,N(a.title),1))])])]),_:1},8,["data"])]),_:1})]),_:1}),e(V,{span:14},{default:l(()=>[e(B,{class:"box-card"},{header:l(()=>[ge]),default:l(()=>[h.value.title?(r(),u("div",ve,[c("div",fe,N(h.value.title),1),c("div",{innerHTML:h.value.content,class:"blog-detail"},null,8,me)])):(r(),u("div",ye," \u8BF7\u9009\u62E9\u4E13\u9898\u6587\u7AE0\uFF0C\u67E5\u770B\u8BE6\u60C5 "))]),_:1})]),_:1})]),_:1})]),_:1},8,["show","buttons"])])}}};const be={class:"title-input"},we={style:{width:"100%"}},ke={__name:"BlogEdit",setup(X,{expose:f,emit:b}){const{proxy:y}=Q(),C=window.innerHeight-60-20-30-50-10-50-10,S=window.innerHeight-60-20-30-50-100-50,h={saveBlog:"/blog/saveBlog4Special",getUserInfo:"getUserInfo",getBlogDetail:"/blog/getBlogById",autoSave:"/blog/autoSaveBlog4Special"};f({init:(d,a)=>{g(),i.show=!0,j(()=>{m.value.resetFields(),n.value={categoryId:a.categoryId,pBlogId:a.blogId},d==="add"?w():D(a.blogId)})}});const w=async()=>{let d=await y.Request({url:h.getUserInfo});!d||(n.value.editorType=d.data.editorType)},D=async d=>{let a=await y.Request({url:h.getBlogDetail,params:{blogId:d}});!a||(n.value=a.data,a.data.tag?n.value.tag=a.data.tag.split("|"):n.value.tag=[])};let _=v(null);const g=()=>{_.value=setInterval(()=>{$()},1e4)},R=()=>{_.value!==null&&(clearInterval(_.value),_.value=null)},$=async()=>{if(n.value.title==null||n.value.content==null||_.value==null)return;const d={};Object.assign(d,n.value);let a=await y.Request({url:h.autoSave,showLoading:!1,params:d});!a||(n.value.blogId=a.data)},i=W({show:!1,buttons:[{type:"danger",text:"\u786E\u5B9A",click:d=>{V()}}]}),m=v(null),n=v({tag:[]}),B=d=>{n.value.content=d},V=()=>{m.value.validate(async d=>{if(!d)return;let a=Object.assign({},n.value);!await y.Request({url:h.saveBlog,params:a})||(y.Message.success("\u4FDD\u5B58\u535A\u5BA2\u6210\u529F"),k())})},k=()=>{i.show=!1,b("callback"),_.value!==null&&R()},E={title:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898"}],content:[{required:!0,message:"\u8BF7\u8F93\u5165\u6B63\u6587"}],categoryId:[{required:!0,message:"\u8BF7\u9009\u62E9\u535A\u5BA2\u5206\u7C7B"}],type:[{required:!0,message:"\u8BF7\u9009\u62E9\u535A\u5BA2\u7C7B\u578B"}],allowComment:[{required:!0,message:"\u8BF7\u9009\u62E9\u662F\u5426\u5141\u8BB8\u8BC4\u8BBA"}],reprintUrl:[{required:!0,message:"\u8BF7\u8F93\u5165\u539F\u6587\u5730\u5740"}]};return ne(()=>{R()}),(d,a)=>{const L=s("el-input"),F=s("el-form-item"),z=s("EditorHtml"),M=s("EditorMarkdown"),A=s("el-form"),t=s("Window");return r(),u("div",null,[e(t,{show:i.show,buttons:i.buttons,onClose:k},{default:l(()=>[e(A,{model:n.value,rules:E,ref_key:"blogFormRef",ref:m},{default:l(()=>[e(F,{prop:"title"},{default:l(()=>[c("div",be,[e(L,{placeholder:"\u8BF7\u8F93\u5165\u535A\u5BA2\u6807\u9898",modelValue:n.value.title,"onUpdate:modelValue":a[0]||(a[0]=o=>n.value.title=o)},null,8,["modelValue"])])]),_:1}),e(F,{prop:"content"},{default:l(()=>[c("div",we,[n.value.editorType==0?(r(),te(z,{key:0,height:S,modelValue:n.value.content,"onUpdate:modelValue":a[1]||(a[1]=o=>n.value.content=o)},null,8,["modelValue"])):(r(),te(M,{key:1,height:C,modelValue:n.value.markdownContent,"onUpdate:modelValue":a[2]||(a[2]=o=>n.value.markdownContent=o),onHtmlContent:B},null,8,["modelValue"]))])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","buttons"])])}}};const Ie=c("div",{class:"card-header"},[c("span",null,"\u4E13\u9898")],-1),Ce={class:"op"},xe=["onClick"],Be={key:1},Se=["onClick"],De={key:3},Re=c("div",{class:"card-header"},[c("span",null,"\u4E13\u9898\u6587\u7AE0")],-1),$e={style:{"margin-bottom":"5px"}},Ve={class:"custom-node-style"},qe={class:"node-title"},Te={key:0,style:{color:"red","font-size":"13px"}},Ee={key:1,style:{color:"green","font-size":"13px"}},He={class:"node-op"},Ue=["onClick"],Ne=["onClick"],je=["onClick"],Le={key:1},Fe=["onClick"],Me={key:3},Oe=["onClick"],Ae={__name:"SpecialList",setup(X){const{proxy:f}=Q(),b={loadDataList:"/category/loadCategory4Special",saveCategory:"/category/saveCategory4Special",delCategory:"category/delCategory4Special",getSpecialInfo:"blog/getSpecialInfo",delBlog:"/blog/recoveryBlog",updateSpecialBlogSort:"blog/updateSpecialBlogSort"},y=v(f.VueCookies.get("userInfo")||{}),C=[{label:"\u5C01\u9762",prop:"cover",width:100,scopedSlots:"cover"},{label:"\u540D\u79F0",prop:"categoryName",width:200},{label:"\u7B80\u4ECB",prop:"categoryDesc"},{label:"\u535A\u5BA2\u6570\u91CF",prop:"blogCount",width:100},{label:"\u64CD\u4F5C",prop:"op",width:100,scopedSlots:"op"}],S=W({}),h={extHeight:135},T=v(null),w=v(null),D=async()=>{let t=await f.Request({url:b.loadDataList});!t||(Object.assign(S,t.data),w.value==null&&t.data.list.length>0&&(w.value=t.data.list[0].categoryId,k()),j(()=>{T.value.setCurrentRow("categoryId",w.value)}))},_=W({show:!1,title:"\u6807\u9898",buttons:[{type:"danger",text:"\u786E\u5B9A",click:t=>{m()}}]}),g=v({}),R={categoryName:[{required:!0,message:"\u8BF7\u8F93\u5165\u5206\u7C7B\u540D\u79F0"}]},$=v(),i=(t,o)=>{_.show=!0,j(()=>{$.value.resetFields(),t=="add"?(_.title="\u65B0\u589E\u5206\u7C7B",g.value={}):t=="update"&&(_.title="\u7F16\u8F91\u5206\u7C7B",g.value=JSON.parse(JSON.stringify(o)))})},m=()=>{$.value.validate(async t=>{if(!t)return;let o={};Object.assign(o,g.value),await f.Request({url:b.saveCategory,params:o})&&(_.show=!1,f.Message.success("\u4FDD\u5B58\u6210\u529F"),D())})},n=t=>{f.Confirm(`\u4F60\u786E\u5B9A\u8981\u5220\u9664${t.categoryName}`,async()=>{!await f.Request({url:b.delCategory,params:{categoryId:t.categoryId}})||(D(),w.value=null)})},B=t=>{w.value=t.categoryId,k()},V=v([]),k=async()=>{let t=await f.Request({url:b.getSpecialInfo,params:{categoryId:w.value,showType:"1"}});V.value=t.data},E={children:"children",label:"title",value:"blogId"},d=v(null),a=(t,o)=>{d.value.init(t,o)},L=()=>{k()},F=t=>{f.Confirm(`\u4F60\u786E\u5B9A\u8981\u5220\u9664\u3010${t.title}\u3011`,async()=>{!await f.Request({url:b.delBlog,params:{blogId:t.blogId}})||k()})},z=async(t,o,H,Y)=>{console.log(t,o,H);let x=null;H=="inner"?x=o:x=o.parent;const J=t.data.blogId,O=x.data.blogId,U=[];x.childNodes.forEach(G=>{U.push(G.data.blogId)});let P={blogId:J,pBlogId:O,blogIds:U.join(",")};!await f.Request({url:b.updateSpecialBlogSort,params:P})||k()},M=v(null),A=t=>{M.value.showDetail(t)};return(t,o)=>{const H=s("el-button"),Y=s("Cover"),x=s("el-divider"),J=s("Table"),O=s("el-card"),U=s("el-col"),P=s("el-alert"),Z=s("el-tree"),G=s("el-row"),ee=s("el-input"),K=s("el-form-item"),oe=s("CoverUpload"),le=s("el-form"),ae=s("Dialog");return r(),u("div",null,[e(H,{type:"danger",onClick:o[0]||(o[0]=I=>i("add"))},{default:l(()=>[re("\u65B0\u589E\u4E13\u9898")]),_:1}),e(G,{gutter:10,style:{"margin-top":"10px"}},{default:l(()=>[e(U,{span:14},{default:l(()=>[e(O,{class:"box-card"},{header:l(()=>[Ie]),default:l(()=>[e(J,{columns:C,showPagination:!0,dataSource:S,fetch:D,options:h,onRowClick:B,ref_key:"dataTableRef",ref:T},{cover:l(({index:I,row:p})=>[e(Y,{cover:p.cover},null,8,["cover"])]),op:l(({index:I,row:p})=>[c("div",Ce,[y.value.userId==p.userId?(r(),u("a",{key:0,href:"javascript:void(0)",class:"a-link",onClick:q=>i("update",p)},"\u4FEE\u6539",8,xe)):(r(),u("span",Be,"--")),e(x,{direction:"vertical"}),y.value.userId==p.userId?(r(),u("a",{key:2,href:"javascript:void(0)",class:"a-link",onClick:q=>n(p)},"\u5220\u9664",8,Se)):(r(),u("span",De,"--"))])]),_:1},8,["dataSource"])]),_:1})]),_:1}),e(U,{span:10},{default:l(()=>[e(O,{class:"box-card"},{header:l(()=>[Re]),default:l(()=>[c("div",$e,[e(P,{title:"\u7EA2\u8272\u4EE3\u8868\u8349\u7A3F\u7EFF\u8272\u4EE3\u8868\u5DF2\u53D1\u5E03\u3001\u62D6\u52A8\u6587\u7AE0\u4FEE\u6539\u6392\u5E8F",type:"info","show-icon":"",closable:!1})]),e(Z,{class:"tree-panel",ref:"refTree",data:V.value,defaultExpandAll:"","node-key":"blogId","expand-on-click-node":!1,props:E,"highlight-current":!0,draggable:"",onNodeDrop:z},{default:l(({node:I,data:p})=>[c("span",Ve,[c("span",qe,[p.status==0?(r(),u("span",Te,N(p.title),1)):(r(),u("span",Ee,N(p.title),1))]),c("span",He,[p.blogId==="0"?(r(),u("a",{key:0,class:"a-link",href:"javascript:void(0)",onClick:q=>a("add",p)},"\u65B0\u589E\u6587\u7AE0",8,Ue)):(r(),u(ce,{key:1},[c("a",{class:"a-link",href:"javascript:void(0)",onClick:q=>A(p)},"\u9884\u89C8",8,Ne),e(x,{direction:"vertical"}),y.value.userId==p.userId?(r(),u("a",{key:0,class:"a-link",href:"javascript:void(0)",onClick:q=>a("edit",p)},"\u4FEE\u6539",8,je)):(r(),u("span",Le,"--")),e(x,{direction:"vertical"}),y.value.userId==p.userId?(r(),u("a",{key:2,class:"a-link",href:"javascript:void(0)",onClick:q=>F(p)},"\u5220\u9664",8,Fe)):(r(),u("span",Me,"--")),e(x,{direction:"vertical"}),c("a",{class:"a-link",href:"javascript:void(0)",onClick:q=>a("add",p)},"\u65B0\u589E\u4E0B\u7EA7\u6587\u7AE0",8,Oe)],64))])])]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),e(ae,{show:_.show,title:_.title,buttons:_.buttons,width:"500px",onClose:o[4]||(o[4]=I=>_.show=!1)},{default:l(()=>[e(le,{model:g.value,rules:R,ref_key:"formDataRef",ref:$,"label-width":"80px"},{default:l(()=>[e(K,{label:"\u540D\u79F0",prop:"categoryName"},{default:l(()=>[e(ee,{placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",modelValue:g.value.categoryName,"onUpdate:modelValue":o[1]||(o[1]=I=>g.value.categoryName=I)},null,8,["modelValue"])]),_:1}),e(K,{label:"\u5C01\u9762",prop:"cover"},{default:l(()=>[e(oe,{modelValue:g.value.cover,"onUpdate:modelValue":o[2]||(o[2]=I=>g.value.cover=I)},null,8,["modelValue"])]),_:1}),e(K,{label:"\u7B80\u4ECB",prop:"categoryDesc"},{default:l(()=>[e(ee,{modelValue:g.value.categoryDesc,"onUpdate:modelValue":o[3]||(o[3]=I=>g.value.categoryDesc=I),type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u7B80\u4ECB",autosize:{minRows:4,maxRows:4}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"]),e(ke,{ref_key:"blogEditRef",ref:d,onCallback:L},null,512),e(he,{ref_key:"blogDetailRef",ref:M},null,512)])}}};export{Ae as default};
